 # Configurazione Iniziale Hardware

La prima cosa da fare sarà quella di assemblare fisicamente il nodo.
Prima ancora però dovremo fare qualche passo preliminare con il PC.

Il menù della sezione quindi è il seguente: 
1. Scaricare il sistema operativo del Raspberry sul PC e copiarlo sulla MicroSD
2. Scaricare la Blockchain sul PC, per poi copiarla sull'HD del Raspberry.
3. Finalmente Assemblare l'Hardware del nodo.

## 1. Scaricare la blockchain di Bitcoin

La Blockchain di bitcoin registra tutte le transazioni e definisce in pratica a chi appartengano quanti bitcoin. Questo database è il punto critico di avere un nodo bitcoin, e quindi dobbiamo porre su di esso molta attenzione. É fondamentale quindi scaricare la blockchain in modo sicuro: l'unico modo di farlo è tramite il software di Bitcoin sul PC, installandolo e poi e lasciandolo sincronizzare. Sarà sicuramente un processo lungo, ma solo in questo modo saremo sicuri che la blockchain scaricata sia quella effettivamente associata alla catena di proof of work più lunga, e quindi quella valida per bitcoin.

Potremmo scaricare la blockchain da torrent o da molti siti, e poi lasciarla analizzare dal nodo. Il rischio sarebbe minimo, o quasi nullo, visto che anche una singola transazione non valida muterebbe irrimediabilmente la validitàà della blockchain. Ma davvero siamo così pigri? 

Una volta scaricata l'intera blcockchain (a novembre 2018 circa 220 GB)  il nostro nodo quindi sarà quindi in grado di 

1. verify every Bitcoin transaction that ever occurred and every block ever mined,
2.create an index database for all transactions, so that we can query it later on,
3. calculate all bitcoin address balances (called the UTXO set).

:point_right: Consultate  [Running a Full Node](https://bitcoin.org/en/full-node) per avere maggiori informazioni su come gestire un nodo bitcoin. 

###Accendiamo il PC 

La validazione della Blockchain, più che il download stesso, è un processo ad intenso uso di CPU, disco e di RAM che può impiegare giorni. Per questo vogliamo farlo su un PC che ha caratteristiche Hardware molto migliori del Raspberry, e sopratutto vogliamo iniziare subito: possono essere necessari diversi giorni, a seconda delle caratteristiche hardware del PC (connessione inclusa, naturalmente). Se al contrario provassimo ad usare un Raspberry probabilmente potrebbero volerci settimane o mesi viste le limitazioni di CPU e soprattuto RAM.  
L'obiettivo di questa prima parte è quindi quello di scaricare e verificare la blockchain installando Bitcoin Core su un PC e quindi trasferire i dati sul Raspberry. Questo sarà necessario solo all'inizio. Una volta inizializzata la blockchain il Pi potrà facilmente stare dietro all'aggiornamento dei singoli blocchi. 



This guide assumes that you will use a  Windows machine for this task, but it works with most operating systems. You need to have about 250 GB free disk space available, internally or on an external hard disk (but not the one reserved for the Pi). As indexing creates heavy read/write traffic, the faster your hard disk the better. An internal drive or an external USB3 hard disk will be significantly faster than one with a USB2 connection.

To copy the blockchain to the Pi later, there are several options:

* **Recommended**: The best configuration is to format the external hard disk of the Pi with the Ext4 file system, which is better suited for our use case. Using SPC, we then copy the blockchain from the Windows computer over the local network.

* **Or**, if you want to use an external hard disk for your Pi that already contains data, eg. because you already downloaded the blockchain, this works as well. You can use the disk as is, but need to skip the formatting part later in this guide.

### Download and verify Bitcoin Core
Download the Bitcoin Core installer from [bitcoincore.org/en/download](https://bitcoincore.org/en/download) and store it in the directory you want to use to download the blockchain. To check the authenticity of the program, we calculate its checksum and compare it with the checksums provided. 

In Windows, I’ll preface all commands you need to enter with `>` , so with the command `> cd bitcoin` , just enter `cd bitcoin` and hit enter.

Open the Windows command prompt (`Win+R`, enter `cmd`, hit `Enter`), navigate to the bitcoin directory (for me, it's on drive `D:`, check in Windows Explorer) and create the new directory `bitcoin_mainnet`. Then calculate the checksum of the already downloaded program.
```
> G:
> cd \bitcoin
> mkdir bitcoin_mainnet
> dir
> certutil -hashfile bitcoin-0.16.3-win64-setup.exe sha256
bd48ec4b7e701b19f993098db70d69f2bdc03473d403db2438aca5e67a86e446
```
![Windows Command Prompt: verify checksum](images/10_blockchain_wincheck.png)

Compare this value with the [release signatures](https://bitcoin.org/bin/bitcoin-core-0.16.3/SHA256SUMS.asc). For the Windows v0.16.3 binaries, its
```
32 bit:  1fe280a78b8796ca02824c6e49d7873ec71886722021871bdd489cbddc37b1f3
64 bit:  bd48ec4b7e701b19f993098db70d69f2bdc03473d403db2438aca5e67a86e446
```
Usually, you would also need to check the signature of this file, but it's a pain on Windows, so we will do it on the Pi later on.

### Installing Bitcoin Core
Execute the Bitcoin Core installation file (you might need to right-click and choose "Run as administrator") and install it using the default settings. Start the program `bitcoin-qt.exe` in the directory "C:\Program Files\Bitcoin". Choose your new “bitcoin_mainnet” folder as the custom data directory.

![Bitcoin Core directory selection](images/10_bitcoinqt_directory.png)

:warning: **IMPORTANT: The next step is crucial. Without `txindex=1` your whole Bitcoin blockchain will be useless** :warning:  
Bitcoin Core opens and starts immediately syncing the blockchain, but we need to set one additional setting in the “bitcoin.conf” file. Using the menu, open `Settings` / `Options` and click the button `Open Configuration File`. Enter the following line:
```
txindex=1
```
If your computer has a lot of memory, you can increase the database in-memory cache by adding the following line (with megabytes of memory to use, adjusted to your computer) as well:
```
dbcache=6000
```
Save and close the text file, quit Bitcoin Core using `File` / `Exit` and restart the program. The program will start syncing again. 

Let the blockchain sync for now, we can already start working on the Pi.



##3.Assemblare l'Hardware del nodo. ##
Il setup sotto riportato è quello che minimizza l’hardware richiesto assicurando un funzionamento corretto e stabile.


Per prima cosa dovremo assemblare il Raspberry. Non dovrebbe essere un problema attaccare i dissipatori ai chip seguendo le immagini dimostrative, avvitare la scheda madre al case usando le apposite viti con il cacciavite in dotazione e per ultimo chiudere il case e montare i piedini di gomma. Come vedete vi è una lunga apertura del case in corrispondenza della porta  GPIO (General Purpose Input/Output port, quella lunga con tutti quei pin, insomma) del Raspberry: visto che non sarà utile nel nostro caso, si può pensare di chiuderla con del nastro adesivo, uno sticker o qualche altra decorazione: il raffreddamento del case non ne soffrirà, ed in compenso limiteremo l’accesso alla polvere: quella è sicuramente dannosa.


A questo punto potremo inserire la scheda Micro SD nello slot del Raspberry. (MA QUANDO CI HO COPIATO IL ISTEMA OPERATIVO DENTRO?)


Colleghiamo alla presa micro usb di alimentazione del Raspberry uno dei due cavi di alimentazioni dell’alimentatore. L’altro invece andrà ad alimentare l’HUB, che a sua volta collegheremo ad una delle 4 prese USB del Raspberry stesso. A questo punto sia il Raspberry che l’HUB sono correttamente alimentati e collegati, possiamo quindi collegare l’Hard Disk all’HUB: sarà quindi solo l’HUB ad alimentare l’Hard disk, che pertanto non andrà a sottrarre amperaggio al funzionamento del Raspberry.
Credo che sia stato tutto abbastanza facile, alla fine dovremmo avere ottenuto un setup simile al seguente: 



![Non è stato difficile alla fine](/images/003.20MinutesLater.JPG)

###### Figura 3. That was easy #######
